---
title: "Developer Manual"
output: 
  rmarkdown::html_vignette:
    toc: false
vignette: >
  %\VignetteIndexEntry{Developer Manual}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Developer Manual

This vignette contains information on how to set-up the package in order to
contribute to the codebase.
It also contains information on how to Maintain and Test the package.

## Developer Installation

If you want to develop the package, you may want to consider cloning the
repository and following the steps below to have the correct environment
to improve the package. First, install the `crvsreportpackage` from GitHub,
then ensure all package dependencies are correctly managed and installed using `renv`:

### 1) Clone the repository:

```sh
git clone https://github.com/tech-acs/crvsreportpackage.git
cd crvsreportpackage
```

### 2) Initialize the `renv` environment: Upon first entering the package directory,
`renv` will activate the specific package environment defined for `crvsreportpackage`.
You need to run the following R commands to restore the required packages:

```R
install.packages("renv")
renv::restore()
```

This will read the `renv.lock` file which contains the dependencies and install
the correct versions of all required packages.

### 3) Once the environment is set up, you can install the package using:

```R
devtools::install()
```

By following these steps, you will ensure that you have all the necessary
dependencies and the correct versions installed, allowing `crvsreportpackage`
to function as intended.
It will also mean you can now open the project and develop the package further.

## Maintenance

Once you have made significant changes to the package, it might be worth considering changing the package version.
This can be done in the DESCRIPTION file, bumping up the `Version` variable.
In order to rebuild and update the `crvsreportpackage` after making some changes to the functions in it follow these steps:

```r
# Remove the installed version of the package
remove.packages("crvsreportpackage")

# Clear your R environment
rm(list = ls())

# Restart R session (do this manually or with RStudio shortcut Ctrl+Shift+F10)

# Initialize renv if not already done
if (!"renv" %in% installed.packages()) {
  install.packages("renv")
}
library(renv)

# Restore the environment
renv::restore()

# Update the lockfile
renv::snapshot()

# Recreate documentation and rebuild the package
library(devtools)
document()  # Generates the NAMESPACE file and documentation using roxygen2
build()     # Builds the package
install()   # Installs the package
```

After these steps the package should be installed with the latest changes to the functions.
This should mean the package is in the right state to be updated on the online repo.

## Testing

Before you push any changes, double check that all the unit test are working
as expected, by running them manually:

```R
testthat::test_dir("tests/testthat")
```

## Further Reading

[R packages](https://r-pkgs.org/) by Hadley Wickham and Jenny Bryan is the canonical guide to R package development.

The [PsyTeachR](https://psyteachr.github.io) Coding Club at the University of Glasgow School of Psychology & Neuroscience also have some really [helpful resources](
https://psyteachr.github.io/intro-r-pkgs/) (a book, YouTube videos) on building R packages.
